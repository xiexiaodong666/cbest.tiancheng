<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.welfare.persist.mapper.AccountCustomizeMapper">
  <sql id="tableName">
        account
    </sql>

  <sql id="baseColumn">
        id,account_name,account_code,account_type_code,mer_code,store_code,account_status,staff_status,active,binding,create_user,create_time,update_user,update_time,account_balance,flag,version,phone
    </sql>
  <select id ="queryPageDTO" resultType="com.welfare.persist.dto.AccountPageDTO">
    SELECT
	a.id,
	a.account_name AS accountName,
	a.account_code AS accountCode,
	a.account_status AS accountStatus,
	d.department_code AS departmentCode,
	d.department_name AS departmentName,
	at.type_name AS accountTypeName,
	a.max_quota AS maxQuota,
	a.surplus_quota AS surplusQuota,
  GROUP_CONCAT(ci.card_id) AS cardId,
	a.account_balance AS accountBalance,
  a.active
FROM
	account a
	INNER JOIN department d ON a.store_code = d.department_code
	LEFT JOIN account_type at ON at.type_code = a.account_type_code
	LEFT JOIN card_info ci ON ci.account_code = a.account_code
  where a.deleted = 0 and d.deleted =0 and at.deleted =0 and ci.deleted =0
    <if test=" merCode !='' and merCode != null ">
      and a.mer_code = #{merCode} and at.mer_code = #{merCode}
    </if>
    <if test=" accountName !='' and accountName != null  ">
      and a.account_name = #{accountName}
    </if>
    <if test=" departmentCode !='' and departmentCode != null ">
      and d.department_code = #{departmentCode}
    </if>
    <if test="accountStatus != null ">
      and a.account_status = #{accountStatus}
    </if>
    <if test=" accountTypeCode !='' and accountTypeCode != null ">
      and at.type_code = #{accountTypeCode}
    </if>
    GROUP BY a.account_code
  </select>

</mapper>